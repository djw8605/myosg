<?
foreach($this->resource_groups as $resource_group_id=>$resource_list) {
    $resource_group = $this->resourcegroups[$resource_group_id][0];
    echo "<div class=\"border\">";
    $gridtype_name = $this->gridtypes[$resource_group->osg_grid_type_id][0]->description;
    echo "<div class='resource_group_header'>";
    if(!isset($_REQUEST["uwa"])) {
        echo "<div class=\"sidenote\">";
        echo $gridtype_name;
        echo "</div>";
    }
    echo "<div class=\"resource_group\">";
    echo "<span class='h3'>".$resource_group->name."</span>";
    if(!isset($_REQUEST["uwa"])) {
        if(isset($_REQUEST["summary_attrs_showdesc"])) {
            echo "<br/>";
            if($resource_group->description != "") {
                echo $resource_group->description;
            } else {
                echo "(No resource group description)";
            }
        }
    }
    echo "</div>";
    echo "</div>";

    $cols = 2; //number of columns to show
    if(isset($_REQUEST["uwa"])) {
        $cols = 1; //only show sequentially on UWA mode
    }
    $col_p = 100 / $cols;

    $col = 0; //current column 
    echo "<table width=\"100%\" style=\"margin: 0px;\"><tr>";
    foreach($resource_list as $rid=>$resource) {
        $col++;
        if($col > $cols) {
            $col = 1;
            echo "</tr><tr>";
        }

        echo "<td style=\"padding: 0px;\" valign=\"top\" width=\"$col_p%\">";
        if(!isset($this->resource_status[$rid])) {
            $note = "Resource status is not calculated for this resource...";
            $status = "UNKNOWN";
        } else {
            $resource_status = $this->resource_status[$rid][0];
            $note = $resource_status->detail;
            $status = Status::getStatus($resource_status->status_id);
        }

        $services = $this->resource_services[$rid];
        if(count($services) == 0) {
            $service_names = "no applicable service exists";
        } else {
            $service_names = "";
            foreach($services as $service) {
                if($service_names != "") $service_names .= " / ";
                if(isset($this->servicetypes[$service->service_id])) {
                    $service_names .= $this->servicetypes[$service->service_id][0]->description;
                } else {
                    $service_names .= "unknown_service_id:".$service->service_id;
                }
            }
        }
    
        echo "<div class=\"status_$status\"><h4><div class=\"resource\">".$resource->name." ($service_names)</div></h4>";
        if(isset($_REQUEST["summary_attrs_showfqdn"])) {
            echo "<span class=\"fqdn\">".$resource->fqdn."</span><br/>";
        }
        if(isset($_REQUEST["summary_attrs_showdesc"])) {
            if($resource->description != "") {
                echo $resource->description."<br/>";
            } else {
                echo "(No resource description)<br/>";
            }
        }
        echo "$note<br/>";

/*
        if(!isset($_REQUEST["uwa"])) {
            $url = base()."/current?resource_id=".$rid;
            echo "<a href=\"$url\">Current Status</a>&nbsp;&nbsp;&nbsp;";
            $url = base()."/history?resource_id=".$rid;
            echo "<a href=\"$url\">Status History</a>&nbsp;&nbsp;&nbsp;";
            $url = base()."/aandrhistory?resource_id=".$rid;
            echo "<a href=\"$url\">Availability History</a>&nbsp;&nbsp;&nbsp;";
        }
*/

        echo "</div>";
        echo "</td>";
    }
    echo "</tr></table>";

    echo "</div>";
}
