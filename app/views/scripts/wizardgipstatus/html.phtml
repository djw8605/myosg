<?
foreach($this->resources as $rid=>$record) {
    $resource_name = $record["name"];
    $resource_fqdn = $record["fqdn"];
    $tests = $record["tests"];
    $interop_bdii = $record["interop_bdii"];
    $type = $record["type"];

    ?>
    <div class="border">
<?
    if(!uwa()) {
        echo "<div style='float: right; background-color: #eee; padding: 5px; width: 200px;'>";

        if($type == "production") {
            $host = "http://is.grid.iu.edu/data";
        } else {
            $host = "http://is-itb.grid.iu.edu/data";
        }

        $raw = "";
        $raw .= "<a target='_blank' href='$host/cemon_transitory/$resource_fqdn'>Incoming Data</a><br/>";
        $raw .= "<a target='_blank' href='$host/cemon_processed_osg/$resource_fqdn.processed'>Fed to OSG BDII (port 2170)</a><br/>";
        if($interop_bdii) {
            $raw .= "<a target='_blank' href='$host/cemon_processed_wlcg_interop/$resource_fqdn.processed'>Fed to Interop BDII (port 2180)</a><br/>";
        }

        echo "<b>Raw CEMon Data</b><br/>$raw";
        echo "</div>";
    }
 
?>
    <div class="resource"><h4><?=$resource_name?></h4></div>
    <div class="indent">
    <?
    if(count($tests) == 0) {
        echo "(No GIP Validation Status is available for this resource)";
    } else {
        foreach($tests as $name=>$test) {

            $gip_status = $test["status"];
            $reason= $test["reason"];

            $status = "UNKNOWN";
            switch($gip_status) {
            case "FAIL":
                $status = "CRITICAL";
                break;
            case "OK":
                $status = "OK";
                break;
            }
            echo outputTestInfo($name, $status, $reason, $rid);
        }
    }
    echo "</div>";//indent
    echo "<div style='clear: both'></div>";
    echo "</div>";//border
}

function outputTestInfo($name, $status, $reason, $rid)
{
    $out = "";
    $out .= "<div class=\"bottom_border status_".$status."\">";

    $out .= "<span class=\"h4\">".$name."</span>";
    if(!uwa()) {
        if($reason != "") {
            $out .= "<br/>$reason";
        }
        if($status == "CRITICAL") {
            $out .= outputAjaxToggle("Issue Detail", base()."/wizardgipstatus/detail?rid=".$rid."&name=".$name);
        } else {
            $out .= "<br/>No issues found for this test.";
        }
    }
    $out .= "</div>";

    return $out;
}

